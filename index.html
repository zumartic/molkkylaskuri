<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mölkky Pisteiden Laskuri</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h1 { text-align: center; }
    #playerCountContainer { text-align: center; margin-bottom: 20px; }
    table { border-collapse: collapse; margin: auto; width: 100%; background: white; }
    th, td { border: 1px solid #ccc; text-align: center; padding: 8px; }
    tfoot td { font-weight: bold; background: #eee; }
    input[type="number"], input[type="text"] {
      width: 60px; padding: 4px; text-align: center;
    }
    button {
      margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer;
    }
    .winner { background-color: #c7f9cc !important; }
    .overlimit { background-color: #ffcccc !important; }
  </style>
</head>
<body>
  <h1>Mölkky Pisteiden Laskuri v2</h1>
  <div id="playerCountContainer">
    Pelaajien määrä:
    <select id="playerCount">
      <option value="1">1</option>
      <option value="2" selected>2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>
    <button onclick="initializeTable()">Aloita peli</button>
  </div>
  <div id="game"></div>
  <script>
    let currentPlayers = 2;

    function initializeTable() {
      currentPlayers = parseInt(document.getElementById("playerCount").value);
      document.getElementById("game").innerHTML = `
        <div style="text-align:center;">
          <strong>Pelatut kierrokset: <span id="roundCounter">0</span></strong>
        </div>
        <table id="scoreTable">
          <thead>
            <tr><th>Kierros</th>${[...Array(currentPlayers)].map((_, i) =>
              `<th><input type="text" value="Pelaaja ${i+1}" onchange="saveData()" /></th>`).join("")}
            </tr>
          </thead>
          <tbody id="scoreBody"></tbody>
          <tfoot>
            <tr><td>Yhteensä</td>${[...Array(currentPlayers)].map((_, i) =>
              `<td id="sum${i}">0</td>`).join("")}
            </tr>
          </tfoot>
        </table>
        <div style="text-align:center;">
          <button onclick="resetScores()">Nollaa pisteet</button>
        </div>`;
      addRound();
    }

    function addRound() {
      const table = document.getElementById("scoreBody");
      const roundNumber = table.children.length + 1;
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${roundNumber}</td>` + [...Array(currentPlayers)].map(() =>
        `<td><input type="number" min="0" max="12" oninput="updateSums()" /></td>`).join("");
      table.appendChild(tr);
      document.getElementById("roundCounter").textContent = roundNumber;
    }

    function updateSums() {
      const rows = document.querySelectorAll("#scoreBody tr");
      let totals = Array(currentPlayers).fill(0);
      let someoneWon = false;

      rows.forEach(row => {
        row.querySelectorAll("td").forEach(td => td.classList.remove("overlimit"));
      });

      for (let p = 0; p < currentPlayers; p++) {
        let total = 0;

        for (let r = 0; r < rows.length; r++) {
          const input = rows[r].querySelectorAll("input")[p];
          let val = parseInt(input.value);
          if (!isNaN(val)) {
            total += val;
            if (total > 50) {
              alert(`Pelaaja ${p + 1} ylitti 50 pistettä kierroksella ${r + 1}. Pistemäärä pudotetaan 25:een.`);
              for (let i = 0; i <= r; i++) {
                rows[i].querySelectorAll("input")[p].value = '';
              }
              rows[r].querySelectorAll("input")[p].value = 25;
              rows[r].querySelectorAll("td")[p + 1].classList.add("overlimit");
              total = 25;
              break;
            }
          }
        }

        totals[p] = total;
        const cell = document.getElementById("sum" + p);
        cell.textContent = total;
        cell.classList.remove("winner");
        if (total === 50) {
          cell.classList.add("winner");
          someoneWon = true;
        }
      }

      const lastRowInputs = rows[rows.length - 1]?.querySelectorAll("input") || [];
      const allFilled = [...lastRowInputs].every(input => input.value !== "");
      if (!someoneWon && allFilled) {
        addRound();
      }
    }

    function resetScores() {
      if (confirm("Haluatko varmasti nollata kaikki pisteet?")) {
        initializeTable();
      }
    }

    function saveData() {
      // valinnainen tallennus myöhempää kehitystä varten
    }

    window.onload = () => {
      initializeTable();
      document.getElementById("playerCount").addEventListener("change", initializeTable);
    };
  </script>
</body>
</html>
