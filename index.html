<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mölkky Pisteiden Laskuri</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; background: #f9f9f9; }
    h1 { text-align: center; font-size: 1.6em; }
    #playerCountContainer { text-align: center; margin-bottom: 15px; }
    table {
      border-collapse: collapse; margin: auto; width: 100%;
      background: white; font-size: 0.95em;
    }
    th, td {
      border: 1px solid #ccc; text-align: center;
      padding: 6px;
    }
    tfoot td {
      font-weight: bold; background: #eee;
    }
    input[type="number"], input[type="text"] {
      width: 50px; padding: 4px; text-align: center;
      font-size: 1em;
    }
    button {
      margin: 5px; padding: 8px 16px; font-size: 1em;
      cursor: pointer;
    }
    .winner { background-color: #c7f9cc !important; }
    .overlimit { background-color: #ffcccc !important; }

    @media (max-width: 600px) {
      input[type="number"], input[type="text"] {
        width: 100%; box-sizing: border-box;
      }
      th, td {
        padding: 4px;
      }
    }
  </style>
</head>
<body>
  <h1>Mölkky Pisteiden Laskuri</h1>
  <div id="playerCountContainer">
    Pelaajien määrä:
    <select id="playerCount">
      <option value="1">1</option>
      <option value="2" selected>2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>
    <button onclick="restartGame()">Aloita peli</button>
  </div>
  <div id="game"></div>
  <script>
    let currentPlayers = 2;
    let playerNames = [];

    function restartGame() {
      const newCount = parseInt(document.getElementById("playerCount").value);
      currentPlayers = newCount;
      playerNames = [...Array(currentPlayers)].map((_, i) => `Pelaaja_${i + 1}`);
      initializeTable();
    }

    function initializeTable() {
      const container = document.getElementById("game");
      container.innerHTML = `
        <div style="text-align:center;">
          <strong>Pelatut kierrokset: <span id="roundCounter">0</span></strong>
        </div>
        <table id="scoreTable">
          <thead>
            <tr><th>Kierros</th>${playerNames.map((name, i) =>
              `<th><input type="text" id="name${i}" value="${name}" onchange="updateNames()" /></th>`).join("")}
            </tr>
          </thead>
          <tbody id="scoreBody"></tbody>
          <tfoot>
            <tr><td>Yhteensä</td>${playerNames.map((_, i) =>
              `<td id="sum${i}">0</td>`).join("")}
            </tr>
          </tfoot>
        </table>`;
      addRound();
    }

    function updateNames() {
      for (let i = 0; i < currentPlayers; i++) {
        const input = document.getElementById("name" + i);
        playerNames[i] = input.value;
      }
    }

    function addRound() {
      const table = document.getElementById("scoreBody");
      const roundNumber = table.children.length + 1;
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${roundNumber}</td>` + playerNames.map(() =>
        `<td><input type="number" min="0" max="12" oninput="updateSums()" /></td>`).join("");
      table.appendChild(tr);
      document.getElementById("roundCounter").textContent = roundNumber;
    }

    function updateSums() {
      const rows = document.querySelectorAll("#scoreBody tr");
      let totals = Array(currentPlayers).fill(0);
      let someoneWon = false;

      rows.forEach(row => {
        row.querySelectorAll("td").forEach(td => td.classList.remove("overlimit"));
      });

      for (let p = 0; p < currentPlayers; p++) {
        let total = 0;
        for (let r = 0; r < rows.length; r++) {
          const input = rows[r].querySelectorAll("input")[p];
          let val = parseInt(input.value);
          if (!isNaN(val)) {
            total += val;
            if (total > 50) {
              alert(`Pelaaja ${p + 1} ylitti 50 pistettä kierroksella ${r + 1}. Pistemäärä pudotetaan 25:een.`);
              for (let i = 0; i <= r; i++) {
                rows[i].querySelectorAll("input")[p].value = '';
              }
              rows[r].querySelectorAll("input")[p].value = 25;
              rows[r].querySelectorAll("td")[p + 1].classList.add("overlimit");
              total = 25;
              break;
            }
          }
        }
        totals[p] = total;
        const cell = document.getElementById("sum" + p);
        cell.textContent = total;
        cell.classList.remove("winner");
        if (total === 50) {
          cell.classList.add("winner");
          someoneWon = true;
        }
      }

      const lastInputs = rows[rows.length - 1]?.querySelectorAll("input") || [];
      const allFilled = [...lastInputs].every(input => input.value !== "");
      if (!someoneWon && allFilled) {
        addRound();
      }
    }

    window.onload = () => {
      restartGame();
      document.getElementById("playerCount").addEventListener("change", restartGame);
    };
  </script>
</body>
</html>
